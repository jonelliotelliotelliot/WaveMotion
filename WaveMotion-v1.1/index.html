<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Motion</title>
    <script src="lib/CSInterface.js"></script>
<style>
    :root {
        --bg-color: #2d2d2d;
        --panel-bg: #3c3c3c;
        --text-color: #e0e0e0;
        --primary-color: #328FF8;
        --hover-color: #76C3FC;
        --dropdown-hover: #FDC237;
        --border-color: #555;
        --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

    }
    body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--font-family);
        margin: 0;
        padding: 15px;
        height: 100vh;
        box-sizing: border-box;
        overflow-y: auto;
    }
    ::-webkit-scrollbar { width: 12px; }
    ::-webkit-scrollbar-track { background: var(--bg-color); }
    ::-webkit-scrollbar-thumb {
        background-color: var(--border-color);
        border-radius: 20px;
        border: 3px solid var(--bg-color);
    }
    ::-webkit-scrollbar-thumb:hover { background-color: #777; }

    .header, .footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .header h1 { font-size: 12px; margin: 0; font-weight: 600; }
    .footer h1 { font-size: 9px; margin: 0; font-weight: 100; }
    .section { margin-bottom: 20px; }
    .section-title { font-size: 14px; font-weight: bold; padding: 6px 0; }
    .button-row { display: flex; gap: 8px; flex-wrap: wrap; }

    /* --- MODIFIED: Base button and dropdown styles --- */
    .btn, .dropdown {
        background-color: var(--panel-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 8px 12px;
        font-size: 12px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.2s, border-color 0.2s;
        font-family: var(--font-family);
        height: 36px; /* Set a consistent height */
        box-sizing: border-box;
    }
    .btn:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    /* NEW: This class makes buttons in a row share space equally */
    .btn-flex {
        flex-grow: 1;
    }
    .btn-full-width {
        width: 100%;
    }

    /* --- MODIFIED: Specific styles for the import dropdown and button --- */
    .dropdown {
        flex-grow: 1; /* Allows the dropdown to expand and fill available space */
        text-align: left;
        -webkit-appearance: none; /* Removes default browser styling */
        appearance: none;
        /* A custom arrow using an embedded SVG for theming */
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23e0e0e0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 8px 8px;
        padding-right: 30px; /* Make space for the custom arrow */
        border-color: #FDC237;


    }
    .dropdown:hover {
        border-color:#FFFFFF; /* Only change border on hover, not background */
    }

    .dropdown option {
        padding: 4px 0;
    }


    .import-btn {
        flex-grow: 0;  /* Do not allow the import button to grow */
        flex-shrink: 0; /* Do not allow it to shrink */
        width: 130px; /* Give it a fixed, comfortable width */
        /*background-color: #FDC237;*/
       /* color: #2d2d2d;
        font-weight: bold;
        letter-spacing:-0.5px;*/

    }

    .swatch-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(31px, 1fr));
        gap: 8px;
    }
    .swatch {
        width: 31px; height: 31px; border-radius: 4px;
        border: 1px solid rgba(0,0,0,0.2); cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .swatch:hover {
        transform: scale(1.1);
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }
    .section-title-container {
         display: flex; margin-bottom: 10px;
         height: 27px; width: 100%;
         align-items: center;
    }
    .section-icon { width:27px; height: 27px; padding-right:18px; }
    .section-icon img { height: 100%; }
    .header-icon { width: 50px; height: 50px; }
    .header-icon img { height: 100%; }

    @media screen and (max-width: 335px) {

         .dropdown {
            margin-bottom: 8px; /* Add space between the stacked elements */
        }

        .dropdown, .import-btn {
            width: 100%; /* Force both elements to take the full width */
            flex-grow: 1; /* Allow them to grow to fill the container */
        }
    }

</style>
</head>
<body>

    <div class="header">
        <h1>Wave Motion v1.1</h1>
        <div class="header-icon"><img src="icons/wave.png"/></div>
    </div>

    <div class="section">
        <div class="section-title-container">
        <div class="section-icon"><img src="icons/back-icon.png"/></div>
        <div class="section-title">Back Easing</div>
        </div>
        <div class="button-row">
            <button class="btn btn-flex" id="btnBackIn">Back In</button>
            <button class="btn btn-flex" id="btnBackOut">Back Out</button>
            <button class="btn btn-flex" id="btnBackInOut">Back In/Out</button>
        </div>
    </div>

    <div class="section">
        <div class="section-title-container">
        <div class="section-icon"><img src="icons/ease-icon.png"/></div>
        <div class="section-title">Generic Eases</div>
        </div>
        <div class="button-row">
            <button class="btn btn-flex" id="btnEasePwr3">InOut Pwr3</button>
            <button class="btn btn-flex" id="btnEasePwr2">InOut Pwr2</button>
            <button class="btn btn-flex" id="btnEasePwr1">InOut Pwr1</button>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title-container">
            <div class="section-icon"><img src="icons/import-icon.png"/></div>
            <div class="section-title">Import</div>
        </div>
        <div class="button-row" id="import-container">
             </div>
    </div>
    <div class="section">
        <div class="section-title-container">
        <div class="section-icon"><img src="icons/text-icon.png"/></div>
        <div class="section-title">Text Animation</div>
        </div>
        <div class="button-row">
            <button class="btn btn-flex" id="btnCharAnim">By character</button>
            <button class="btn btn-flex" id="btnWordAnim">By word</button>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Utilities</div>
        <div class="button-row">
            <button class="btn btn-full-width" id="btnClickAnim">Apply Click Animation</button>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Color Swatches</div>
        <div class="swatch-grid" id="swatch-container">
            </div>
    </div>

    <div class="footer">
        <h1> @description A dockable After Effects ScriptUI panel for applying custom easing presets,
 * importing project elements, and performing other animation utilities.<br><br> @author jon elliot <br>@date 2025-07-06</h1>
    </div>

    <script>
        (function () {
            'use strict';
            var csInterface = new CSInterface();

            const COMP_DEFS = [
                { name: "cursor",        anchor: [32, 19],   collapse: true },
                { name: "button-pill",   anchor: [200, 75],  collapse: true },
                { name: "button-square", anchor: [238, 75],  collapse: true },
                { name: "click-pulse",   anchor: [100, 100], collapse: true },
                { name: "grad-stroke",   anchor: [525, 315], collapse: true },
                { name: "status-flip",   anchor: [300, 300], collapse: false},
                { name: "vessel-background",   anchor: [1920, 1080], collapse: false },
                { name: "grid-background",   anchor: [1920, 1080], collapse: false },
                { name: "vessel-transition",   anchor: [1920, 1080], collapse: false }   
            ];

            const SWATCH_COLORS = [
                [0/255,  27/255, 102/255], [0/255,  64/255, 255/255], [50/255, 143/255, 248/255],
                [118/255,195/255,252/255], [250/255,244/255,241/255], [243/255,167/255,255/255],
                [143/255, 74/255, 226/255], [253/255,194/255, 55/255], [253/255,111/255, 0/255],
                [0/255, 130/255, 56/255], [12/255, 69/255, 39/255]
            ];

            function init() {
                // Easing Buttons
                document.getElementById('btnBackIn').addEventListener('click', () => applyEase('backIn'));
                document.getElementById('btnBackOut').addEventListener('click', () => applyEase('backOut'));
                document.getElementById('btnBackInOut').addEventListener('click', () => applyEase('backInOut'));
                document.getElementById('btnEasePwr3').addEventListener('click', () => applyEase('easeInOutPwr3'));
                document.getElementById('btnEasePwr2').addEventListener('click', () => applyEase('easeInOutPwr2'));
                document.getElementById('btnEasePwr1').addEventListener('click', () => applyEase('easeInOutPwr1'));
                
                document.getElementById('btnClickAnim').addEventListener('click', applyClickAnimation);
                document.getElementById('btnCharAnim').addEventListener('click', applyCharAnimation);
                document.getElementById('btnWordAnim').addEventListener('click', applyWordAnimation);

                // === MODIFIED: Create and populate the Import Dropdown ===
                const importContainer = document.getElementById('import-container');
                
                // 1. Create the dropdown menu
                const select = document.createElement('select');
                select.className = 'dropdown'; // Use new class for styling
                select.id = 'import-select';

                // 2. Create and add an option for each comp definition
                COMP_DEFS.forEach(def => {
                    const option = document.createElement('option');
                    option.textContent = def.name; // This is the text the user sees
                    option.value = JSON.stringify(def); // Store the entire object as a JSON string
                    select.appendChild(option);
                });

                // 3. Create the single import button
                const importBtn = document.createElement('button');
                importBtn.className = 'btn import-btn'; // Use new class for styling
                importBtn.textContent = 'Import Selected';
                
                // 4. Add the event listener to the button
                importBtn.addEventListener('click', () => {
                    const selectedDefJSON = select.value; // Get the JSON string from the selected option
                    if (selectedDefJSON) {
                        importAndPlaceComp(selectedDefJSON);
                    }
                });

                // 5. Add the new elements to the container
                importContainer.appendChild(select);
                importContainer.appendChild(importBtn);
                // =========================================================

                // Dynamically create Color Swatches
                const swatchContainer = document.getElementById('swatch-container');
                SWATCH_COLORS.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'swatch';
                    const rgb = color.map(c => Math.round(c * 255));
                    swatch.style.backgroundColor = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
                    swatch.title = `RGB: ${rgb.join(', ')}`;
                    swatch.addEventListener('click', () => {
                        applySwatchColor(JSON.stringify(color));
                    });
                    swatchContainer.appendChild(swatch);
                });
            }

            // --- ExtendScript Function Calls ---
            function applyEase(easeKey) {
                csInterface.evalScript(`applyEase("${easeKey}")`);
            }
            function applyClickAnimation() {
                csInterface.evalScript('applyClickAnimation()');
            }
            function importAndPlaceComp(defAsJSON) {
                var extensionPath = csInterface.getSystemPath(SystemPath.EXTENSION);
                csInterface.evalScript(`importAndPlaceComp('${defAsJSON}', ${JSON.stringify(extensionPath)})`, function(result) {
                    var resultObj = JSON.parse(result);
                    if (!resultObj.success) {
                        alert(resultObj.message);
                    } else {
                        console.log(resultObj.message);
                    }
                });
            }
            function applyCharAnimation() {
                csInterface.evalScript('applyCharAnimation()');
            }
             function applyWordAnimation() {
                csInterface.evalScript('applyWordAnimation()');
            }
            function applySwatchColor(colorAsJSON) {
                csInterface.evalScript(`applySwatchColor('${colorAsJSON}')`);
            }

            init();
        }());
    </script>
</body>
</html>